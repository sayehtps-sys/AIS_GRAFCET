{
  "title": "Ex 01",
  "grafcet": "// 0. Wait at Home (A)\nS0*\nS0 -> S1 : dcy . sens_a\n\n// 1. Go to End (B)\nS1 \"Move_R\"\nS1 -> S2 : sens_b\n\n// 2. Return to Middle (C)\nS2 \"Move_L\"\nS2 -> S3 : sens_c\n\n// 3. Go back to End (B)\nS3 \"Move_R\"\nS3 -> S4 : sens_b\n\n// 4. Return Home (A)\nS4 \"Move_L\"\nS4 -> S0 : sens_a",
  "svg": "<svg viewBox=\"0 0 800 500\" style=\"font-family: Segoe UI, Arial, sans-serif; background: #eceff1;\">\n  <defs>\n    <!-- DASHBOARD GRADIENTS -->\n    <radialGradient id=\"led-off\" cx=\"50%\" cy=\"50%\" r=\"50%\">\n      <stop offset=\"0%\" stop-color=\"#455a64\"></stop>\n      <stop offset=\"100%\" stop-color=\"#263238\"></stop>\n    </radialGradient>\n    <radialGradient id=\"led-green\" cx=\"50%\" cy=\"50%\" r=\"50%\">\n      <stop offset=\"0%\" stop-color=\"#69f0ae\"></stop>\n      <stop offset=\"100%\" stop-color=\"#00c853\"></stop>\n    </radialGradient>\n    <radialGradient id=\"led-blue\" cx=\"50%\" cy=\"50%\" r=\"50%\">\n      <stop offset=\"0%\" stop-color=\"#40c4ff\"></stop>\n      <stop offset=\"100%\" stop-color=\"#0091ea\"></stop>\n    </radialGradient>\n    \n    <!-- SCENE GRADIENTS -->\n    <linearGradient id=\"rail-metal\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"100%\">\n      <stop offset=\"0%\" stop-color=\"#b0bec5\"></stop>\n      <stop offset=\"40%\" stop-color=\"#ffffff\"></stop>\n      <stop offset=\"100%\" stop-color=\"#90a4ae\"></stop>\n    </linearGradient>\n    <linearGradient id=\"cart-body\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"100%\">\n      <stop offset=\"0%\" stop-color=\"#ffca28\"></stop>\n      <stop offset=\"100%\" stop-color=\"#ff8f00\"></stop>\n    </linearGradient>\n\n    <!-- SHADOWS -->\n    <filter id=\"soft-shadow\">\n      <feDropShadow dx=\"3\" dy=\"4\" stdDeviation=\"3\" flood-opacity=\"0.3\"></feDropShadow>\n    </filter>\n  </defs>\n\n  <!-- ================= DASHBOARD (Top Panel) ================= -->\n  <rect width=\"800\" height=\"140\" fill=\"#263238\" stroke-bottom=\"#000\"></rect>\n  <line x1=\"0\" y1=\"140\" x2=\"800\" y2=\"140\" stroke=\"#111\" stroke-width=\"4\"></line>\n\n  <!-- 1. CONTROLS -->\n  <g transform=\"translate(30, 20)\">\n    <rect width=\"120\" height=\"100\" rx=\"8\" fill=\"#37474f\" stroke=\"#546e7a\" stroke-width=\"2\"></rect>\n    <text x=\"60\" y=\"20\" text-anchor=\"middle\" fill=\"#cfd8dc\" font-size=\"11\" font-weight=\"bold\">OPERATOR</text>\n    <!-- DCY Button -->\n    <circle id=\"btn-dcy\" cx=\"60\" cy=\"60\" r=\"25\" fill=\"#00c853\" stroke=\"#4caf50\" stroke-width=\"2\" cursor=\"pointer\" onmousedown=\"pressDcy()\"></circle>\n    <text x=\"60\" y=\"65\" text-anchor=\"middle\" fill=\"#fff\" font-weight=\"bold\" font-size=\"10\" pointer-events=\"none\">START</text>\n  </g>\n\n  <!-- 2. SENSORS (INPUTS) -->\n  <g transform=\"translate(180, 20)\">\n    <rect width=\"280\" height=\"100\" rx=\"8\" fill=\"#37474f\" stroke=\"#546e7a\" stroke-width=\"2\"></rect>\n    <text x=\"140\" y=\"20\" text-anchor=\"middle\" fill=\"#cfd8dc\" font-size=\"11\" font-weight=\"bold\">POSITION SENSORS (INPUTS)</text>\n    \n    <!-- Sensor A -->\n    <g transform=\"translate(50, 45)\">\n        <text x=\"0\" y=\"-10\" text-anchor=\"middle\" fill=\"#b0bec5\" font-size=\"10\">A (Home)</text>\n        <circle id=\"dash-sens-a\" cx=\"0\" cy=\"15\" r=\"12\" fill=\"url(#led-green)\" stroke=\"#222\"></circle>\n    </g>\n    <!-- Sensor C -->\n    <g transform=\"translate(140, 45)\">\n        <text x=\"0\" y=\"-10\" text-anchor=\"middle\" fill=\"#b0bec5\" font-size=\"10\">C (Mid)</text>\n        <circle id=\"dash-sens-c\" cx=\"0\" cy=\"15\" r=\"12\" fill=\"url(#led-off)\" stroke=\"#222\"></circle>\n    </g>\n    <!-- Sensor B -->\n    <g transform=\"translate(230, 45)\">\n        <text x=\"0\" y=\"-10\" text-anchor=\"middle\" fill=\"#b0bec5\" font-size=\"10\">B (End)</text>\n        <circle id=\"dash-sens-b\" cx=\"0\" cy=\"15\" r=\"12\" fill=\"url(#led-off)\" stroke=\"#222\"></circle>\n    </g>\n  </g>\n\n  <!-- 3. ACTIONS (OUTPUTS) -->\n  <g transform=\"translate(490, 20)\">\n    <rect width=\"200\" height=\"100\" rx=\"8\" fill=\"#37474f\" stroke=\"#546e7a\" stroke-width=\"2\"></rect>\n    <text x=\"100\" y=\"20\" text-anchor=\"middle\" fill=\"#cfd8dc\" font-size=\"11\" font-weight=\"bold\">MOTOR (OUTPUTS)</text>\n\n    <!-- Move Left -->\n    <g transform=\"translate(50, 45)\">\n        <text x=\"0\" y=\"-10\" text-anchor=\"middle\" fill=\"#b0bec5\" font-size=\"10\">Move L</text>\n        <rect id=\"dash-act-l\" x=\"-15\" y=\"0\" width=\"30\" height=\"30\" rx=\"4\" fill=\"url(#led-off)\" stroke=\"#222\"></rect>\n    </g>\n    <!-- Move Right -->\n    <g transform=\"translate(150, 45)\">\n        <text x=\"0\" y=\"-10\" text-anchor=\"middle\" fill=\"#b0bec5\" font-size=\"10\">Move R</text>\n        <rect id=\"dash-act-r\" x=\"-15\" y=\"0\" width=\"30\" height=\"30\" rx=\"4\" fill=\"url(#led-off)\" stroke=\"#222\"></rect>\n    </g>\n  </g>\n\n\n  <!-- ================= FIELD SCENE ================= -->\n  <g transform=\"translate(50, 300)\">\n    \n    <!-- RAIL -->\n    <rect x=\"0\" y=\"20\" width=\"700\" height=\"20\" rx=\"5\" fill=\"url(#rail-metal)\" stroke=\"#78909c\"></rect>\n    <line x1=\"50\" y1=\"40\" x2=\"650\" y2=\"40\" stroke=\"#b0bec5\" stroke-dasharray=\"10,10\"></line>\n\n    <!-- --- PHYSICAL SENSORS (On Rail) --- -->\n    <!-- Sensor A (Left) -->\n    <g transform=\"translate(50, 30)\">\n        <rect x=\"-8\" y=\"0\" width=\"16\" height=\"25\" fill=\"#ffc107\" stroke=\"#e65100\" stroke-width=\"1\"></rect>\n        <circle id=\"field-sens-a\" cx=\"0\" cy=\"12\" r=\"5\" fill=\"#ff1744\"></circle>\n        <text x=\"0\" y=\"40\" text-anchor=\"middle\" font-size=\"12\" font-weight=\"bold\" fill=\"#555\">A</text>\n    </g>\n    <!-- Sensor C (Middle) -->\n    <g transform=\"translate(350, 30)\">\n        <rect x=\"-8\" y=\"0\" width=\"16\" height=\"25\" fill=\"#ffc107\" stroke=\"#e65100\" stroke-width=\"1\"></rect>\n        <circle id=\"field-sens-c\" cx=\"0\" cy=\"12\" r=\"5\" fill=\"url(#led-off)\"></circle>\n        <text x=\"0\" y=\"40\" text-anchor=\"middle\" font-size=\"12\" font-weight=\"bold\" fill=\"#555\">C</text>\n    </g>\n    <!-- Sensor B (Right) -->\n    <g transform=\"translate(650, 30)\">\n        <rect x=\"-8\" y=\"0\" width=\"16\" height=\"25\" fill=\"#ffc107\" stroke=\"#e65100\" stroke-width=\"1\"></rect>\n        <circle id=\"field-sens-b\" cx=\"0\" cy=\"12\" r=\"5\" fill=\"url(#led-off)\"></circle>\n        <text x=\"0\" y=\"40\" text-anchor=\"middle\" font-size=\"12\" font-weight=\"bold\" fill=\"#555\">B</text>\n    </g>\n\n    <!-- --- AGV CART --- -->\n    <g id=\"cart\" transform=\"translate(50, 0)\" filter=\"url(#soft-shadow)\">\n        <!-- Wheels -->\n        <circle cx=\"-25\" cy=\"35\" r=\"10\" fill=\"#333\"></circle>\n        <circle cx=\"25\" cy=\"35\" r=\"10\" fill=\"#333\"></circle>\n        <!-- Body -->\n        <path d=\"M-40,0 L40,0 L40,30 L-40,30 Z\" fill=\"url(#cart-body)\" stroke=\"#e65100\" stroke-width=\"2\"></path>\n        <!-- Bumper Stripe -->\n        <rect x=\"-40\" y=\"20\" width=\"80\" height=\"10\" fill=\"#333\" opacity=\"0.1\"></rect>\n        <text x=\"0\" y=\"18\" text-anchor=\"middle\" font-weight=\"bold\" fill=\"#4e342e\" font-size=\"12\">SHUTTLE</text>\n        \n        <!-- Action Indicators (On Cart) -->\n        <path id=\"arrow-l\" d=\"M-30,10 L-20,5 L-20,15 Z\" fill=\"#555\"></path>\n        <path id=\"arrow-r\" d=\"M30,10 L20,5 L20,15 Z\" fill=\"#555\"></path>\n    </g>\n\n  </g>\n\n  <!-- STATUS TEXT -->\n  <text id=\"debug-txt\" x=\"400\" y=\"460\" text-anchor=\"middle\" font-size=\"14\" fill=\"#607d8b\" font-weight=\"bold\">IDLE</text>\n\n</svg>",
  "initialState": {
    "x": 50,
    "dcy": false,
    "txt": "IDLE"
  },
  "logic": "// --- HELPERS ---\nif(!window.pressDcy) {\n    window.pressDcy = function() {\n        state.dcy = true;\n        setTimeout(() => state.dcy = false, 400);\n    };\n}\n\n// --- CONSTANTS ---\nconst SPEED = 200;\n// Rail Positions matches SVG translates\nconst POS_A = 50;\nconst POS_C = 350;\nconst POS_B = 650;\nconst TOLERANCE = 5;\n\n// --- PHYSICS ---\nif (inputs.Move_R) {\n    state.x += SPEED * dt;\n    state.txt = \"MOVING RIGHT >>\";\n} \nelse if (inputs.Move_L) {\n    state.x -= SPEED * dt;\n    state.txt = \"<< MOVING LEFT\";\n} else {\n    state.txt = \"IDLE\";\n}\n\n// Mechanical Stops (Clamping)\nstate.x = Math.max(POS_A, Math.min(POS_B, state.x));\n\n// --- SENSORS ---\nconst sens_a = Math.abs(state.x - POS_A) <= TOLERANCE;\nconst sens_c = Math.abs(state.x - POS_C) <= TOLERANCE;\nconst sens_b = Math.abs(state.x - POS_B) <= TOLERANCE;\n\n// --- VISUAL UPDATES ---\n\n// 1. Move Cart\nsvg.querySelector('#cart').setAttribute('transform', `translate(${state.x}, 0)`);\nsvg.querySelector('#debug-txt').textContent = state.txt;\n\n// 2. LED Helper Function\nconst setLed = (id, isActive, colorType) => {\n    let fill = 'url(#led-off)';\n    if(isActive) {\n        if(colorType === 'green') fill = 'url(#led-green)';\n        if(colorType === 'blue') fill = 'url(#led-blue)';\n        if(colorType === 'red') fill = '#ff1744'; // Flat red for field sensors\n    }\n    svg.querySelector(id).setAttribute('fill', fill);\n};\n\n// 3. Update Dashboard (Inputs - Green)\nsetLed('#dash-sens-a', sens_a, 'green');\nsetLed('#dash-sens-c', sens_c, 'green');\nsetLed('#dash-sens-b', sens_b, 'green');\nsvg.querySelector('#btn-dcy').setAttribute('stroke', state.dcy ? '#fff' : '#4caf50');\n\n// 4. Update Dashboard (Outputs - Blue)\nsetLed('#dash-act-l', inputs.Move_L, 'blue');\nsetLed('#dash-act-r', inputs.Move_R, 'blue');\n\n// 5. Update Field Sensors (Red when hit)\nsetLed('#field-sens-a', sens_a, 'red');\nsetLed('#field-sens-c', sens_c, 'red');\nsetLed('#field-sens-b', sens_b, 'red');\n\n// 6. Update Cart Arrows\nsvg.querySelector('#arrow-l').setAttribute('fill', inputs.Move_L ? '#ffff00' : '#555');\nsvg.querySelector('#arrow-r').setAttribute('fill', inputs.Move_R ? '#ffff00' : '#555');\n\n// --- RETURN ---\nreturn {\n    dcy: state.dcy,\n    sens_a: sens_a,\n    sens_b: sens_b,\n    sens_c: sens_c\n};",
  "layout": {
    "nodes": {
      "S0": {
        "x": 23.375,
        "y": 57
      },
      "S1": {
        "x": 23.625,
        "y": 171
      },
      "S2": {
        "x": 23.749999046325684,
        "y": 275.625
      },
      "S3": {
        "x": 23.125,
        "y": 388.125
      },
      "S4": {
        "x": 22.727272033691406,
        "y": 507.272705078125
      },
      "T_0": {
        "x": 23.40909194946289,
        "y": 106.93181610107422
      },
      "T_1": {
        "x": 23.374999046325684,
        "y": 224.375
      },
      "T_2": {
        "x": 23.75,
        "y": 333.75
      },
      "T_3": {
        "x": 22.5,
        "y": 448.125
      },
      "T_4": {
        "x": 23.18181800842285,
        "y": 561.8182373046875
      }
    },
    "loops": {
      "T_4-S0": 147.72726440429688
    }
  }
}